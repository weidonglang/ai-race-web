<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arena 使用教程 · AI Race</title>
  <link rel="stylesheet" href="/src/style.css"/>

  <style>
    main.doc-page{
      max-width: 960px;
      margin:24px auto 40px;
      padding:0 16px 40px;
    }
    .doc-hero,
    .doc-section{
      position:relative;
      margin-top:24px;
      padding:20px 20px 22px;
      border-radius:18px;
      border:1px solid #1c2533;
      background:radial-gradient(circle at top left,
                  rgba(16,185,129,0.15), rgba(15,23,42,1) 55%);
      overflow:hidden;
      opacity:0;
      transform:translateY(22px);
      transition:
        opacity .65s ease-out,
        transform .65s ease-out,
        box-shadow .65s ease-out,
        border-color .65s ease-out,
        background 1s ease-out;
    }
    .doc-hero::before,
    .doc-section::before{
      content:"";
      position:absolute;
      inset:-1px;
      background:linear-gradient(120deg,
                  rgba(52,211,153,0.0),
                  rgba(52,211,153,0.35),
                  rgba(14,165,233,0.0));
      transform:translateX(-45%);
      opacity:0;
      transition:
        transform 1.1s ease-out,
        opacity 1.1s ease-out;
      pointer-events:none;
    }
    .doc-visible{
      opacity:1;
      transform:none;
      box-shadow:0 26px 70px rgba(0,0,0,.55);
      border-color:rgba(45,212,191,.8);
      background:radial-gradient(circle at top left,
                  rgba(16,185,129,0.22), rgba(15,23,42,1) 60%);
    }
    .doc-visible::before{
      transform:translateX(0);
      opacity:1;
    }

    .doc-hero h1{
      margin:0 0 8px;
      font-size:26px;
    }
    .doc-hero p{
      margin:4px 0 0;
      color:var(--muted);
      font-size:13px;
      max-width:520px;
    }

    .doc-section h2{
      margin:0 0 8px;
      font-size:20px;
    }
    .doc-section h3{
      margin:14px 0 4px;
      font-size:15px;
    }
    .doc-section p{
      margin:4px 0 8px;
      font-size:14px;
      line-height:1.65;
      color:var(--muted);
    }
    .doc-section ul{
      margin:6px 0 8px 1.1em;
      padding:0;
      font-size:14px;
      color:var(--muted);
    }
    .doc-section li{margin:2px 0;}
    .step-badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:22px;
      height:22px;
      border-radius:999px;
      background:rgba(16,185,129,.22);
      border:1px solid rgba(45,212,191,.7);
      font-size:12px;
      margin-right:6px;
    }
    code{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      background:#020617;
      padding:1px 4px;
      border-radius:4px;
      border:1px solid #1f2937;
    }
  </style>

  <!-- 统一外观：共享文档样式（覆盖上方旧样式以保持一致） -->
  <style>
    :root{
      --doc-accent: #34d399;
      --doc-accent-2: #22d3ee;
      --doc-border: #1c2533;
      --doc-bg: #0e1320;
      --doc-muted: #9db0c6;
    }
    main.doc-page{
      max-width: 960px;
      margin:24px auto 40px;
      padding:0 16px 40px;
    }
    .doc-hero,
    .doc-section{
      position:relative;
      margin-top:24px;
      padding:20px 20px 22px;
      border-radius:18px;
      border:1px solid var(--doc-border);
      background:radial-gradient(circle at 12% 0%,
                  color-mix(in srgb, var(--doc-accent) 24%, transparent),
                  var(--doc-bg) 62%);
      overflow:hidden;
      opacity:0;
      transform:translateY(22px);
      transition:
        opacity .65s ease-out,
        transform .65s ease-out,
        box-shadow .65s ease-out,
        border-color .65s ease-out,
        background 1s ease-out;
    }
    .doc-hero::before,
    .doc-section::before{
      content:"";
      position:absolute;
      inset:-1px;
      background:linear-gradient(120deg,
                  color-mix(in srgb, var(--doc-accent) 0%, transparent),
                  color-mix(in srgb, var(--doc-accent-2) 34%, transparent),
                  color-mix(in srgb, var(--doc-accent) 0%, transparent));
      transform:translateX(-45%);
      opacity:0;
      transition:
        transform 1.1s ease-out,
        opacity 1.1s ease-out;
      pointer-events:none;
    }
    .doc-visible{
      opacity:1;
      transform:none;
      box-shadow:0 26px 70px rgba(0,0,0,.55);
      border-color:color-mix(in srgb, var(--doc-accent) 58%, #1f2a3a 42%);
      background:radial-gradient(circle at 14% 0%,
                  color-mix(in srgb, var(--doc-accent-2) 22%, transparent),
                  var(--doc-bg) 68%);
    }
    .doc-visible::before{
      transform:translateX(0);
      opacity:1;
    }

    .doc-hero h1{
      margin:0 0 8px;
      font-size:26px;
      letter-spacing:.02em;
    }
    .doc-hero p{
      margin:4px 0 0;
      color:var(--doc-muted);
      font-size:13px;
      max-width:520px;
    }
    .doc-section h2{
      margin:0 0 8px;
      font-size:20px;
    }
    .doc-section h3{
      margin:14px 0 4px;
      font-size:15px;
    }
    .doc-section p{
      margin:4px 0 8px;
      font-size:14px;
      line-height:1.65;
      color:var(--doc-muted);
    }
    .doc-section ul{
      margin:6px 0 8px 1.1em;
      padding:0;
      font-size:14px;
      color:var(--doc-muted);
    }
    .doc-section li{ margin:2px 0; }
  </style>

  <!-- 返回按钮统一样式（与文档主题色呼应） -->
  <style>
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 12px;
      border: 1px solid color-mix(in srgb, var(--doc-accent, #38bdf8) 55%, #1f2937 45%);
      background: linear-gradient(120deg, var(--doc-accent, #38bdf8), var(--doc-accent-2, #a855f7));
      color: #e5e7eb;
      cursor: pointer;
      font-size: 13px;
      letter-spacing: 0.1px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    .back-btn:hover{
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 16px 34px rgba(0,0,0,0.4);
    }
    .back-btn:active{
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(0,0,0,0.32);
    }
  </style>
</head>
<body>
<header class="guide-header">
  <div class="guide-header-inner">
    <a href="index.html" class="brand">
      <img src="/log.svg" alt="AI Race logo" class="brand-logo">
      <span class="brand-text">AI Race</span>
    </a>
    <ul class="nav">
      <li><a href="editor.html">编辑器</a></li>
      <li><a href="lab.html">AI 实验室</a></li>
      <li><a href="dashboard.html">训练看板</a></li>
      <li><a href="arena.html">对抗 Arena</a></li>
      <li>
        <a href="#">更多 ▾</a>
        <div class="dropdown">
          <a href="help.html">帮助/原理</a>
          <a href="about.html">关于</a>
        </div>
      </li>
    </ul>
    <button class="back-btn" onclick="if (history.length > 1) history.back(); else location.href='index.html'">返回</button>
  </div>
</header>

<main class="doc-page">
  <section class="doc-hero">
    <h1>对抗 Arena 使用全流程</h1>
    <p>
      本页对应 <code>arena.html</code> 与 <code>arena_train.js</code>，
      从「进入页面」到「加载迷宫、启动对抗、观察 RL 训练」完整走一遍，
      帮助你快速上手这个 3D 迷宫双智能体 Arena。
    </p>
  </section>

  <!-- 1. 进入 Arena 前的准备 -->
  <section class="doc-section">
    <h2>① 进入 Arena 前：Lab 配置 + 迷宫文件</h2>
    <h3><span class="step-badge">1</span>在 Lab 中配置好 RL 超参数</h3>
    <p>
      推荐先打开 <code>lab.html</code>，设置折扣因子 γ、学习率 α、
      初始探索率 ε 和衰减系数等，并点击保存。<code>lab.js</code> 会把配置写入
      <code>localStorage('ai_lab_params')</code>。
    </p>
    <p>Arena 在创建 RL 智能体时会读取这份配置，使训练和调参解耦。</p>

    <h3><span class="step-badge">2</span>准备好迷宫 JSON 文件（如果需要）</h3>
    <p>
      Arena 右侧的「加载迷宫」区域假定你已经使用
      <code>tools/maze_*.py</code> 生成了类似
      <code>mazes/maze_easy_000.json</code> 的文件。
    </p>
    <ul>
      <li>简单迷宫：<code>maze_easy_*.json</code></li>
      <li>中等迷宫：<code>maze_medium_*.json</code></li>
      <li>困难迷宫：<code>maze_hard_*.json</code></li>
    </ul>
    <p>不同按钮会随机选取对应难度的一张迷宫作为当前场景。</p>
  </section>

  <!-- 2. 页面结构 -->
  <section class="doc-section">
    <h2>② 页面结构总览：左 3D 视图 + 右控制面板</h2>
    <h3>左侧：Three.js 迷宫与双选手</h3>
    <p>
      左侧是由 Three.js 渲染的 3D 迷宫场景，两名选手分别以不同颜色显示：
    </p>
    <ul>
      <li>A 选手：<b>蓝色</b>；</li>
      <li>B 选手：<b>橙色</b>。</li>
    </ul>
    <p>
      在对抗模式下，两名选手会在同一迷宫中同步前进，
      根据各自奖励函数和进化参数调整速度和探索偏好。
    </p>

    <h3>右侧：多块 Arena 面板</h3>
    <ul>
      <li><b>迷宫信息</b>：显示迷宫 ID、难度、尺寸等基本信息。</li>
      <li>
        <b>加载迷宫</b>：三个按钮
        <code>随机简单迷宫 / 随机中等迷宫 / 随机困难迷宫</code>
        用于快速切换场景。
      </li>
      <li><b>当前对抗 Episode</b>：显示当前局号及状态（Idle / Running / Done）。</li>
      <li><b>A/B 选手统计</b>：记录每局的用时、路径长度、探索格子数、陷阱命中、积分等。</li>
      <li><b>对抗控制</b>：控制「进化对抗」模式（持续多局运行）。</li>
      <li><b>RL 训练（双智能体对比）</b>：统计基于 Q-learning 的训练表现。</li>
      <li><b>RL 控制</b>：以 Episode 为单位启动 / 暂停 / 单步推进训练，并调节速度。</li>
    </ul>
  </section>

  <!-- 3. 进化对抗流程 -->
  <section class="doc-section">
    <h2>③ 进化对抗模式：多局 A/B 对抗</h2>
    <h3><span class="step-badge">1</span>加载一张迷宫</h3>
    <p>
      在「加载迷宫」卡片中点击：
      <code>随机简单迷宫</code> / <code>随机中等迷宫</code> /
      <code>随机困难迷宫</code> 任意一个按钮。
    </p>
    <p>左侧 3D 视图会重置为一个新的迷宫，右侧的迷宫信息面板会更新 ID、难度和尺寸。</p>

    <h3><span class="step-badge">2</span>开始持续对抗</h3>
    <p>在「对抗控制（进化模式）」卡片中：</p>
    <ul>
      <li>点击 <code>开始持续对抗</code>：开启自动多局对抗。</li>
      <li>在对抗过程中，可以随时点击 <code>暂停 / 继续</code> 来暂时停下或恢复。</li>
      <li>点击 <code>下一局</code>：只推进一局，便于逐局观察细节。</li>
      <li>点击 <code>清空历史记录</code>：重置历史对抗统计，并清空
        <code>localStorage('arena_runs')</code> 中的记录。
      </li>
    </ul>

    <h3><span class="step-badge">3</span>观察对抗结果</h3>
    <p>
      「结果」卡片会显示当前局的胜者（A/B）以及历史对抗局数，
      可以用来评估在当前迷宫与奖励设计下哪一名选手占优。
    </p>
  </section>

  <!-- 4. RL 训练流程 -->
  <section class="doc-section">
    <h2>④ RL 训练流程：从 Arena 到 Dashboard</h2>
    <h3><span class="step-badge">1</span>确认 Lab 参数已保存</h3>
    <p>
      确保在 Lab 页面保存过一份合适的 Q-learning 参数，
      Arena 会自动从 <code>localStorage('ai_lab_params')</code> 中读取。
    </p>

    <h3><span class="step-badge">2</span>启动 RL 训练</h3>
    <p>在「RL 控制」卡片中有四个关键按钮：</p>
    <ul>
      <li><code>开始 RL 训练</code>：创建两个 RL 智能体 A/B，并开始面向当前迷宫的训练。</li>
      <li><code>暂停 / 继续</code>：在训练过程中临时停下或恢复。</li>
      <li><code>单步：两边各跑 1 局</code>：只让 A/B 各自再训练一局，便于教学演示。</li>
      <li><code>重置 Q 表</code>：丢弃当前 Q 表和统计信息，重新从零训练。</li>
    </ul>

    <h3><span class="step-badge">3</span>调整训练速度</h3>
    <p>
      速度滑块 <code>训练速度</code>（<code>#rlSpeed</code>）通过对数插值控制
      「每秒训练步数」：
    </p>
    <ul>
      <li>滑到最左：近似「慢动作」，可以清楚观察探索过程。</li>
      <li>滑到中间或更右：快速积累大量 Episode，用于观察收敛趋势。</li>
      <li>右侧文本 <code>#rlSpeedValue</code> 会实时显示估算的 steps/s。</li>
    </ul>

    <h3><span class="step-badge">4</span>查看 RL 面板统计</h3>
    <p>
      「RL 训练（双智能体对比）」卡片中包含：
    </p>
    <ul>
      <li><b>总局数（A | B）</b>：自本次训练开始以来已完成的 Episode 数。</li>
      <li><b>成功率（最近 100 局）</b>：基于滑动窗口统计成功比例。</li>
      <li><b>平均奖励（最近 100 局）</b>：每局累计奖励的平均值。</li>
      <li><b>平均步数 / 最短步数</b>：路径效率，越接近 1 越好。</li>
      <li><b>首次达到 100% 成功率的局号</b>：谁先练成「必过」迷宫。</li>
      <li><b>最近一局步数 / 当前 ε</b>：用于观察最新训练动态。</li>
    </ul>
    <p>
      这些统计同时会被 <code>arena_train.js</code> 以快照形式写入
      <code>localStorage('arena_rl_dual_stats')</code>，
      供 Dashboard 进一步绘制折线图。
    </p>
  </section>

  <!-- 5. 与 Dashboard 的配合 -->
  <section class="doc-section">
    <h2>⑤ 与训练看板联动</h2>
    <p>
      在 Arena 中进行一段时间的 RL 训练后，可以切换到
      <a href="dashboard.html">训练看板</a> 页面，使用折线图对比 A/B 的长期表现：
    </p>
    <ul>
      <li>成功率曲线是否逐渐趋近于 100%。</li>
      <li>平均步数是否逐渐逼近「最短步数」。</li>
      <li>不同 ε 衰减策略对收敛速度的影响。</li>
    </ul>
    <p>这构成了一个完整的实验闭环：<b>Lab 调参 → Arena 训练 → Dashboard 评估</b>。</p>
  </section>
</main>

<footer class="footer">© 2025 AI Race Demo</footer>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const els = document.querySelectorAll('.doc-hero, .doc-section')
    const io = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('doc-visible')
          io.unobserve(e.target)
        }
      })
    }, { threshold: 0.18 })
    els.forEach(el => io.observe(el))
  })
</script>
</body>
</html>



