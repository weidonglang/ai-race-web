<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>对抗 Arena · AI Race</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/src/style.css">
</head>
<body>
  <!-- 顶部统一导航 -->
  <header>
    <a href="index.html" class="brand">
    <img src="/log.svg" alt="AI Race logo" class="brand-logo">
    <span class="brand-text">AI Race</span>
  </a>
    <ul class="nav">
      <!-- 返回上一个界面 -->
      <li>
        <a href="javascript:void(0)"
           onclick="if (history.length > 1) { history.back(); } else { window.location.href='index.html'; }">
          ← 返回
        </a>
      </li>

      <li><a href="editor.html">编辑器</a></li>
      <li><a href="lab.html">AI 实验室</a></li>
      <li><a href="dashboard.html">训练看板</a></li>
      <li><a href="arena.html">对抗 Arena</a></li>
      <li>
        <a href="#">更多 ▾</a>
        <div class="dropdown">
          <a href="help.html">帮助/原理</a>
          <a href="about.html">关于</a>
        </div>
      </li>
    </ul>
  </header>

  <!-- Arena 主体：左边 WebGL 视图，右边控制与 HUD -->
  <main class="arena-layout">
    <section id="arena-viewport"></section>

    <aside id="arena-panel">
      <h1 style="margin-top:0;">对抗 Arena</h1>
      <p class="arena-muted">
        本页用于双智能体在同一迷宫中的对抗训练，以及两个可视化的 RL 智能体（A/B）。
        迷宫从 <code>./mazes</code> 目录随机加载简单 / 中等 / 困难关卡，
        蓝/橙球用于进化式对抗，紫/绿球用于 Q-learning 强化学习对比。
      </p>

      <!-- 迷宫信息 -->
      <div class="arena-card">
        <h2>迷宫信息</h2>
        <div class="arena-kv"><span>ID</span><span id="arenaMazeId">-</span></div>
        <div class="arena-kv"><span>难度</span><span id="arenaMazeDiff">-</span></div>
        <div class="arena-kv"><span>尺寸</span><span id="arenaMazeSize">-</span></div>
      </div>

      <!-- 迷宫加载 -->
      <div class="arena-card arena-controls">
        <h2>加载迷宫</h2>
        <button id="btnMazeEasy">随机简单迷宫</button>
        <button id="btnMazeMedium">随机中等迷宫</button>
        <button id="btnMazeHard">随机困难迷宫</button>
        <p class="arena-muted" style="margin-top:8px;">
          假定你已经用 <code>tools/maze_*.py</code> 生成了
          <code>mazes/maze_easy_000.json</code> 等文件。
        </p>
      </div>

      <!-- 当前对抗 Episode 信息（进化对抗用） -->
      <div class="arena-card">
        <h2>当前对抗 Episode</h2>
        <div class="arena-kv"><span>Episode</span><span id="arenaEp">0</span></div>
        <div class="arena-kv"><span>状态</span><span id="arenaStatus">Idle</span></div>
      </div>

      <!-- A 选手 -->
      <div class="arena-card">
        <h2>A 选手（蓝）</h2>
        <div class="arena-kv"><span>用时</span><span id="arenaTimeA">0.00 s</span></div>
        <div class="arena-kv"><span>路径长度</span><span id="arenaLenA">0.00 m</span></div>
        <div class="arena-kv"><span>探索格子</span><span id="arenaExploreA">0</span></div>
        <div class="arena-kv"><span>陷阱命中</span><span id="arenaTrapsA">0</span></div>
        <div class="arena-kv"><span>积分</span><span id="arenaScoreA">0</span></div>
      </div>

      <!-- B 选手 -->
      <div class="arena-card">
        <h2>B 选手（橙）</h2>
        <div class="arena-kv"><span>用时</span><span id="arenaTimeB">0.00 s</span></div>
        <div class="arena-kv"><span>路径长度</span><span id="arenaLenB">0.00 m</span></div>
        <div class="arena-kv"><span>探索格子</span><span id="arenaExploreB">0</span></div>
        <div class="arena-kv"><span>陷阱命中</span><span id="arenaTrapsB">0</span></div>
        <div class="arena-kv"><span>积分</span><span id="arenaScoreB">0</span></div>
      </div>

      <!-- 进化对抗结果 -->
      <div class="arena-card">
        <h2>结果</h2>
        <div class="arena-kv"><span>胜者</span><span id="arenaWinner">-</span></div>
        <div class="arena-kv"><span>历史对抗数</span><span id="arenaHistCount">0</span></div>
      </div>

      <!-- 进化对抗控制 -->
      <div class="arena-card arena-controls">
        <h2>对抗控制（进化模式）</h2>
        <button id="btnArenaStart">开始持续对抗</button>
        <button id="btnArenaPause">暂停 / 继续</button>
        <button id="btnArenaNext">下一局</button>
        <button id="btnArenaClear">清空历史记录</button>
        <p class="arena-muted" style="margin-top:8px;">
          每一局中，两名选手沿同一迷宫路径前进，
          根据奖励积分模块自动调整速度与探索偏好。
          历史结果保存在 <code>localStorage('arena_runs')</code>。
        </p>
      </div>

      <!-- ⬇⬇⬇ RL 训练统计面板（双智能体对比） ⬇⬇⬇ -->
      <div class="arena-card">
        <h2>RL 训练（双智能体对比）</h2>

        <div class="arena-kv">
          <span>总局数（A | B）</span>
          <span id="rlEp">A: 0 | B: 0</span>
        </div>
        <div class="arena-kv">
          <span>成功率（最近 100 局）</span>
          <span id="rlSuccRate">A: 0.0% | B: 0.0%</span>
        </div>
        <div class="arena-kv">
          <span>平均奖励（最近 100 局）</span>
          <span id="rlAvgR">A: 0.00 | B: 0.00</span>
        </div>
        <div class="arena-kv">
          <span>平均步数 / 最短步数</span>
          <span id="rlAvgSteps">
            A: 0.0 ( -×最短 ) | B: 0.0 ( -×最短 )
          </span>
        </div>
        <div class="arena-kv">
          <span>首次达到 100% 成功率的局号</span>
          <span id="rlLastR">first100% A: - | B: -</span>
        </div>
        <div class="arena-kv">
          <span>最近一局步数</span>
          <span id="rlLastSteps">lastSteps A: 0 | B: 0</span>
        </div>
        <div class="arena-kv">
          <span>当前 ε</span>
          <span id="rlEpsNow">eps A: 1.00 | B: 1.00</span>
        </div>

        <p class="arena-muted" style="margin-top:8px;">
          A（紫）和 B（绿）使用不同 Q-learning 超参数在同一迷宫中训练：
          对比谁更快把最近 100 局成功率练到 100%，以及谁的平均步数更接近最短路径。
        </p>
      </div>
      <!-- ⬆⬆⬆ RL 训练统计面板结束 ⬆⬆⬆ -->

      <!-- RL 控制面板 -->
      <div class="arena-card arena-controls">
        <h2>RL 控制</h2>
        <button id="btnRlStart">开始 RL 训练</button>
        <button id="btnRlPause">暂停 / 继续</button>
        <button id="btnRlStepEp">单步：两边各跑 1 局</button>
        <button id="btnRlReset">重置 Q 表</button>

        <!-- 速度调节滑块 -->
        <div class="arena-kv" style="margin-top:8px; align-items:center; gap:8px;">
          <label for="rlSpeed" style="flex:0 0 auto;">训练速度</label>
          <input
            id="rlSpeed"
            type="range"
            min="1"
            max="100"
            value="50"
            style="flex:1 1 auto;"
          />
          <span id="rlSpeedValue"
                style="flex:0 0 auto; width:5.5em; text-align:right;">—</span>
        </div>

        <p class="arena-muted" style="margin-top:8px;">
          滑块控制“每秒训练步数”（steps/s），使用对数插值，既能慢速观看单步探索，
          也能快速累积大量训练。数值会实时显示在右侧。
        </p>
      </div>

    </aside>
  </main>

  <footer class="footer">© 2025 AI Race Demo</footer>

  <!-- 对抗 Arena + RL 训练 的入口脚本 -->
  <script type="module" src="/src/arena_train.js"></script>
</body>
</html>



