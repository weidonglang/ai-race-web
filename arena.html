<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>对抗 Arena · AI Race</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/src/style.css">
</head>
<body>
  <!-- 顶部统一导航 -->
  <header>
    <a href="index.html" style="font-weight:700">AI Race</a>
    <ul class="nav">
      <!-- 返回上一个界面 -->
      <li>
        <a href="javascript:void(0)"
           onclick="if (history.length > 1) { history.back(); } else { window.location.href='index.html'; }">
          ← 返回
        </a>
      </li>

      <li><a href="editor.html">编辑器</a></li>
      <li><a href="lab.html">AI 实验室</a></li>
      <li><a href="dashboard.html">训练看板</a></li>
      <li><a href="arena.html">对抗 Arena</a></li>
      <li>
        <a href="#">更多 ▾</a>
        <div class="dropdown">
          <a href="replays.html">回放库</a>
          <a href="help.html">帮助/原理</a>
          <a href="about.html">关于</a>
        </div>
      </li>
    </ul>
  </header>

  <!-- Arena 主体：左边 WebGL 视图，右边控制与 HUD -->
  <main class="arena-layout">
    <section id="arena-viewport"></section>

    <aside id="arena-panel">
      <h1 style="margin-top:0;">对抗 Arena</h1>
      <p class="arena-muted">
        本页用于双智能体在同一迷宫中的对抗训练，以及一个可视化的 RL 训练智能体。
        当前实现：从 <code>./mazes</code> 目录随机加载简单 / 中等 / 困难迷宫，
        A/B 选手进行进化式对抗，RL 智能体则使用 Q-learning 在同一迷宫中反复探索。
      </p>

      <!-- 迷宫信息 -->
      <div class="arena-card">
        <h2>迷宫信息</h2>
        <div class="arena-kv"><span>ID</span><span id="arenaMazeId">-</span></div>
        <div class="arena-kv"><span>难度</span><span id="arenaMazeDiff">-</span></div>
        <div class="arena-kv"><span>尺寸</span><span id="arenaMazeSize">-</span></div>
      </div>

      <!-- 迷宫加载 -->
      <div class="arena-card arena-controls">
        <h2>加载迷宫</h2>
        <button id="btnMazeEasy">随机简单迷宫</button>
        <button id="btnMazeMedium">随机中等迷宫</button>
        <button id="btnMazeHard">随机困难迷宫</button>
        <p class="arena-muted" style="margin-top:8px;">
          假定你已经用 <code>tools/maze_*.py</code> 生成了
          <code>mazes/maze_easy_000.json</code> 等文件。
        </p>
      </div>

      <!-- 当前对抗 Episode 信息（进化对抗用） -->
      <div class="arena-card">
        <h2>当前对抗 Episode</h2>
        <div class="arena-kv"><span>Episode</span><span id="arenaEp">0</span></div>
        <div class="arena-kv"><span>状态</span><span id="arenaStatus">Idle</span></div>
      </div>

      <!-- A 选手 -->
      <div class="arena-card">
        <h2>A 选手（蓝）</h2>
        <div class="arena-kv"><span>用时</span><span id="arenaTimeA">0.00 s</span></div>
        <div class="arena-kv"><span>路径长度</span><span id="arenaLenA">0.00 m</span></div>
        <div class="arena-kv"><span>探索格子</span><span id="arenaExploreA">0</span></div>
        <div class="arena-kv"><span>陷阱命中</span><span id="arenaTrapsA">0</span></div>
        <div class="arena-kv"><span>积分</span><span id="arenaScoreA">0</span></div>
      </div>

      <!-- B 选手 -->
      <div class="arena-card">
        <h2>B 选手（橙）</h2>
        <div class="arena-kv"><span>用时</span><span id="arenaTimeB">0.00 s</span></div>
        <div class="arena-kv"><span>路径长度</span><span id="arenaLenB">0.00 m</span></div>
        <div class="arena-kv"><span>探索格子</span><span id="arenaExploreB">0</span></div>
        <div class="arena-kv"><span>陷阱命中</span><span id="arenaTrapsB">0</span></div>
        <div class="arena-kv"><span>积分</span><span id="arenaScoreB">0</span></div>
      </div>

      <!-- 进化对抗结果 -->
      <div class="arena-card">
        <h2>结果</h2>
        <div class="arena-kv"><span>胜者</span><span id="arenaWinner">-</span></div>
        <div class="arena-kv"><span>历史对抗数</span><span id="arenaHistCount">0</span></div>
      </div>

      <!-- 进化对抗控制 -->
      <div class="arena-card arena-controls">
        <h2>对抗控制（进化模式）</h2>
        <button id="btnArenaStart">开始持续对抗</button>
        <button id="btnArenaPause">暂停 / 继续</button>
        <button id="btnArenaNext">下一局</button>
        <button id="btnArenaClear">清空历史记录</button>
        <p class="arena-muted" style="margin-top:8px;">
          每一局中，两名选手沿同一迷宫路径前进，
          根据奖励积分模块自动调整速度与探索偏好。
          历史结果保存在 <code>localStorage('arena_runs')</code>。
        </p>
      </div>

      <!-- ⬇⬇⬇ 新增：RL 训练统计面板 ⬇⬇⬇ -->
      <div class="arena-card">
        <h2>RL 训练（单智能体）</h2>
        <div class="arena-kv"><span>总局数</span><span id="rlEp">0</span></div>
        <div class="arena-kv"><span>成功率（最近 100 局）</span><span id="rlSuccRate">0%</span></div>
        <div class="arena-kv"><span>平均奖励（最近 100 局）</span><span id="rlAvgR">0.00</span></div>
        <div class="arena-kv"><span>平均步数（最近 100 局）</span><span id="rlAvgSteps">0.0</span></div>
        <div class="arena-kv"><span>最近一局奖励</span><span id="rlLastR">0.00</span></div>
        <div class="arena-kv"><span>最近一局步数</span><span id="rlLastSteps">0</span></div>
        <div class="arena-kv"><span>当前 ε</span><span id="rlEpsNow">1.00</span></div>
      </div>

      <div class="arena-card arena-controls">
        <h2>RL 控制</h2>
        <button id="btnRlStart">开始 RL 训练</button>
        <button id="btnRlPause">暂停 / 继续</button>
        <button id="btnRlStepEp">单步：跑 1 局</button>
        <button id="btnRlReset">重置 Q 表</button>
        <p class="arena-muted" style="margin-top:8px;">
          RL 智能体使用 Q-learning 在当前迷宫上探索：起点出发，
          每走一步有时间惩罚，踩红色陷阱会直接死亡并重开一局，
          到达终点获得高奖励。随着局数增加，你会看到其成功率上升、
          平均步数下降，并且在 3D 场景中明显减少“乱撞”和踩雷。
        </p>
      </div>
      <!-- ⬆⬆⬆ RL 面板结束 ⬆⬆⬆ -->

    </aside>
  </main>

  <footer class="footer">© 2025 AI Race Demo</footer>

  <!-- 对抗 Arena + RL 训练 的入口脚本 -->
  <script type="module" src="/src/arena_train.js"></script>
</body>
</html>
